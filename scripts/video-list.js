/* global store YouTube */

'use strict';

const testData = {
  "kind": "youtube#searchListResponse",
  "etag": "\"XI7nbFXulYBIpL0ayR_gDh3eu1k/bBYjLez20l-_MKO54_kNoOAZSoA\"",
  "nextPageToken": "CAUQAA",
  "regionCode": "US",
  "pageInfo": {
    "totalResults": 1000000,
    "resultsPerPage": 5
  },
  "items": [
    {
      "kind": "youtube#searchResult",
      "etag": "\"XI7nbFXulYBIpL0ayR_gDh3eu1k/3GvmmEApNX5dJzBymRzvcBvZGdQ\"",
      "id": {
        "kind": "youtube#video",
        "videoId": "N2z5dSRkv_I"
      },
      "snippet": {
        "publishedAt": "2018-08-26T11:00:04.000Z",
        "channelId": "UC9obdDRxQkmn_4YpcBMTYLw",
        "title": "Bet you havent't LAUGHED THAT HARD before! - Super FUNNY CATS",
        "description": "The funniest animals on the planet are definitely cats! They never fail to make us laugh and happy! This is the most impossible TRY NOT TO LAUGH challenge ...",
        "thumbnails": {
          "default": {
            "url": "https://i.ytimg.com/vi/N2z5dSRkv_I/default.jpg",
            "width": 120,
            "height": 90
          },
          "medium": {
            "url": "https://i.ytimg.com/vi/N2z5dSRkv_I/mqdefault.jpg",
            "width": 320,
            "height": 180
          },
          "high": {
            "url": "https://i.ytimg.com/vi/N2z5dSRkv_I/hqdefault.jpg",
            "width": 480,
            "height": 360
          }
        },
        "channelTitle": "Tiger FunnyWorks",
        "liveBroadcastContent": "none"
      }
    },
    {
      "kind": "youtube#searchResult",
      "etag": "\"XI7nbFXulYBIpL0ayR_gDh3eu1k/CIzHxn5Tg3A4s2nJ1YNkNe9bwj8\"",
      "id": {
        "kind": "youtube#video",
        "videoId": "hY7m5jjJ9mM"
      },
      "snippet": {
        "publishedAt": "2017-05-31T09:30:02.000Z",
        "channelId": "UC9obdDRxQkmn_4YpcBMTYLw",
        "title": "CATS will make you LAUGH YOUR HEAD OFF - Funny CAT compilation",
        "description": "Cats are amazing creatures because they make us laugh all the time! Watching funny cats is the hardest try not to laugh challenge! Just look how all these cats ...",
        "thumbnails": {
          "default": {
            "url": "https://i.ytimg.com/vi/hY7m5jjJ9mM/default.jpg",
            "width": 120,
            "height": 90
          },
          "medium": {
            "url": "https://i.ytimg.com/vi/hY7m5jjJ9mM/mqdefault.jpg",
            "width": 320,
            "height": 180
          },
          "high": {
            "url": "https://i.ytimg.com/vi/hY7m5jjJ9mM/hqdefault.jpg",
            "width": 480,
            "height": 360
          }
        },
        "channelTitle": "Tiger FunnyWorks",
        "liveBroadcastContent": "none"
      }
    },
    {
      "kind": "youtube#searchResult",
      "etag": "\"XI7nbFXulYBIpL0ayR_gDh3eu1k/JkELFAyKQf3jC6ObuMsX4Hc3Hhw\"",
      "id": {
        "kind": "youtube#video",
        "videoId": "Rmx1JGTX1yw"
      },
      "snippet": {
        "publishedAt": "2018-07-26T11:00:05.000Z",
        "channelId": "UC9obdDRxQkmn_4YpcBMTYLw",
        "title": "Funniest CATS EVER - Die LAUGING NOW!",
        "description": "Cats are the best pets and animals! Cats and kittens are so funny, they make us laugh and happy! They never fail to amuse us! This is the most impossible TRY ...",
        "thumbnails": {
          "default": {
            "url": "https://i.ytimg.com/vi/Rmx1JGTX1yw/default.jpg",
            "width": 120,
            "height": 90
          },
          "medium": {
            "url": "https://i.ytimg.com/vi/Rmx1JGTX1yw/mqdefault.jpg",
            "width": 320,
            "height": 180
          },
          "high": {
            "url": "https://i.ytimg.com/vi/Rmx1JGTX1yw/hqdefault.jpg",
            "width": 480,
            "height": 360
          }
        },
        "channelTitle": "Tiger FunnyWorks",
        "liveBroadcastContent": "none"
      }
    },
    {
      "kind": "youtube#searchResult",
      "etag": "\"XI7nbFXulYBIpL0ayR_gDh3eu1k/qT9xssHPIvatz74gf98V67GmP4s\"",
      "id": {
        "kind": "youtube#video",
        "videoId": "uCLEq9V0-Yk"
      },
      "snippet": {
        "publishedAt": "2018-05-17T13:02:36.000Z",
        "channelId": "UCKy3MG7_If9KlVuvw3rPMfw",
        "title": "SUPER WEIRD CATS that will totally CONFUSE YOU! - Extremely FUNNY CAT VIDEOS compilation",
        "description": "Here are videos of super weird cats and kittens that will confuse you and at the end, most important, make you laugh! These cats are so super hilarious that I bet ...",
        "thumbnails": {
          "default": {
            "url": "https://i.ytimg.com/vi/uCLEq9V0-Yk/default.jpg",
            "width": 120,
            "height": 90
          },
          "medium": {
            "url": "https://i.ytimg.com/vi/uCLEq9V0-Yk/mqdefault.jpg",
            "width": 320,
            "height": 180
          },
          "high": {
            "url": "https://i.ytimg.com/vi/uCLEq9V0-Yk/hqdefault.jpg",
            "width": 480,
            "height": 360
          }
        },
        "channelTitle": "Tiger Productions",
        "liveBroadcastContent": "none"
      }
    },
    {
      "kind": "youtube#searchResult",
      "etag": "\"XI7nbFXulYBIpL0ayR_gDh3eu1k/2J8q77MF8IM0F88ttFhy4DodrqM\"",
      "id": {
        "kind": "youtube#video",
        "videoId": "-zzWoYIAv5I"
      },
      "snippet": {
        "publishedAt": "2018-06-21T16:04:58.000Z",
        "channelId": "UC9obdDRxQkmn_4YpcBMTYLw",
        "title": "CATS make us LAUGH ALL THE TIME! - Ultra FUNNY CAT videos",
        "description": "Ultra funny cats and kitten that will make you cry with laughter! Cats are the best animals, they make us laugh all the time! This is the hardest TRY NOT TO ...",
        "thumbnails": {
          "default": {
            "url": "https://i.ytimg.com/vi/-zzWoYIAv5I/default.jpg",
            "width": 120,
            "height": 90
          },
          "medium": {
            "url": "https://i.ytimg.com/vi/-zzWoYIAv5I/mqdefault.jpg",
            "width": 320,
            "height": 180
          },
          "high": {
            "url": "https://i.ytimg.com/vi/-zzWoYIAv5I/hqdefault.jpg",
            "width": 480,
            "height": 360
          }
        },
        "channelTitle": "Tiger FunnyWorks",
        "liveBroadcastContent": "none"
      }
    }
  ]
};


// Get user input
// handleFormSubmit
// Modify state
// fetchVideos
// decorateResponse
// generateVideoItemHtml
// Update the view

/*
    We want our store to hold an array of "decorated" video objects - i.e. objects that
    have been transformed into ONLY the necessary data we're displaying on our page. 
    (Removes extraneous dataset from Youtube.)
    
    Example decorated video object:
    
    {
      id: '98ds8fbsdy67',
      title: 'Cats dancing the Macarena',
      thumbnail: 'https://img.youtube.com/some/thumbnail.jpg'
    }
*/

const videoList = (function () {
  /**
   * @function decorateResponse
   * Uses Youtube API response to create an array of "decorated" video objects as 
   * defined at the top of the file.
   * @param   {object} response - should match Youtube API response shape
   * @returns {array}
   */
  // TASK:
  // 1. Map through the response object's `items` array
  // 2. Return an array of objects, where each object contains the keys `id`, `title`, 
  //    `thumbnail` which each hold the appropriate values from the API item object. You 
  //    WILL have to dig into several nested properties!
  //
  // TEST IT! Grab an example API response and send it into the function - make sure
  // you get back the object you want.
  const decorateResponse = function (response) {
    return response.items.map(item => {
      return {
        id: item.id.videoId,
        title: item.snippet.title,
        thumbnail: item.snippet.thumbnails.high.url
      };
    });
  };





  /**
   * @function generateVideoItemHtml
   * Template function, creates an HTML string from a single decorated video object
   * @param   {object} video - decorated video object
   * @returns {string} HTML 
   */
  // TASK:
  // 1. Using the decorated object, return an HTML string containing all the expected
  // TEST IT!
  const generateVideoItemHtml = function (video) {

  };

  /**
   * @function render
   * Responsible for scanning store and rendering the video list to DOM
   */
  // TASK:
  // 1. Map through `store.videos`, sending each `video` through `generateVideoItemHtml`
  // 2. Add this array of DOM elements to the appropriate DOM element
  // TEST IT!
  const render = function () {
    // const results = data.items.map((item, index) => renderResult(item));
    // $('.js-search-results').html(results);
  };

  /**
   * @function handleFormSubmit
   * Adds form "submit" event listener that 1) initiates API call, 2) modifies store,
   * and 3) invokes render
   */
  // TASK:
  // 2. Add an event listener to the form that will:
  //   a) Prevent default event
  //   b) Retrieve the search input from the DOM
  //   c) Clear the search input field
  //   d) Invoke the `fetchVideos` function, sending in the search value
  //   e) Inside the callback, send the API response through the `decorateResponse` function
  //   f) Inside the callback, add the decorated response into your store using the 
  //      `addVideosToStore` function
  //   g) Inside the callback, run the `render` function 
  // TEST IT!
  // const handleFormSubmit = function() {
  //   $('form').on('submit', event => {
  //     event.preventDefault();
  //     // Get user input
  //     const userInputField = $('#search-term');
  //     const userInput = userInputField.val();
  //     userInputField.val('');
  //     // Modify state
  //     YouTube.fetchVideos(userInput, response => {
  //       const decorated = decorateResponse(response);
  //       // This gives us an array of objects with the information we want
  //       // Add new information to the store
  //       // Render the new DOM with the new information
  //     });


  //     // Render the new state
  //     render();
  //   });
  // };

  const bindEventHandlers = function () {
    handleFormSubmit();
  };

  return {
    render,
    bindEventHandlers
  };
}());